<%= content_for :js do %>
<script>
const mymap = L.map('map').locate({setView: true, maxZoom: 16}); //.setView([28.5383, -81.3792], 14);
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoiYmdhdGVzIiwiYSI6ImNqcnF2N3JzMDAxYmc0N29jMWQ1NXBzOHYifQ.iz7LrIADHLcFLuWtPeJOsQ'
}).addTo(mymap);
const invitations = <%= @invitations.to_json.html_safe %>; 
invitations.forEach(invite => {
  const marker = L.marker([invite.latitude, invite.longitude]).addTo(mymap);
  marker.bindPopup(`<strong>${invite.time}</strong> - <a href="${invite.link}">@${invite.userName}</a> is going to ${invite.where}`)
});
document.getElementById('map').style.height = document.getElementById('map-wrapper').clientHeight + 'px';
</script>
<% end %>
<div class="container">
  <h1>Lunch with Developers</h1>
  <div id="map-wrapper">
    <div id="map"></div>
  </div>
  <div>
    <h2>What</h2>
    <p>The map shows members of the Orlando Developers community who have said where they are having lunch today.</p>
    <h2>Why</h2>
    <p>It would be nice to get to know some devs in a casual environment. Meetups are too big to get to know anyone well, and post-Meetup drinks are too late. With lunch, you can meet people over food, so if you have nothing to say you can fall back on chewing.</p>
    <h2>How</h2>
    <p>Each pin on the map will show the ODev Slack username of a person who's announced availability to meet for lunch today. If you click on a username, Slack will open to a private message between you and that person.</p>
    <p>If you want to get your own pin on the map, log into ODev Slack and use the command `/lunch`.</p>
  </div>
</div>